<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Ship Equipment Status</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f9f9f9; padding: 20px; }
    h2 { color: #2e7d32; }
    select { padding: 6px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #2e7d32; color: white; }
    .category-row { background-color: #1b5e20; color: white; font-weight: bold; text-align: left; }
    
    /* 상태별 색상 */
    .done { background-color: #e8f5e9; }   /* 연녹색 (✅ 완료) */
    .pending { background-color: #ffebee; } /* 연분홍 (❌ 미완료) */

    a { color: #2e7d32; text-decoration: none; font-weight: bold; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h2>🚢 Ship Equipment Status</h2>

  <form method="get" action="/">
    <label for="ship_number"><b>Ship Number:</b></label>
    <select name="ship_number" id="ship_number" onchange="this.form.submit()">
      <option value="">-- Select --</option>
      <option value="1" {% if selected_ship == "1" %}selected{% endif %}>Ship 1</option>
      <option value="2" {% if selected_ship == "2" %}selected{% endif %}>Ship 2</option>
      <option value="3" {% if selected_ship == "3" %}selected{% endif %}>Ship 3</option>
    </select>
  </form>

  {% if catalog and selected_ship %}
  <table>
    <tr>
      <th>Equipment</th>
      <th>Responsible</th>
      <th>Status</th>
      <th>Action</th>
    </tr>

    {% for cat, eqs in catalog.items() %}
      <tr class="category-row">
        <td colspan="4">{{ cat }}</td>
      </tr>
      {% for eq, info in eqs.items() %}
      <tr class="{% if info.status == 'done' %}done{% else %}pending{% endif %}">
        <td>{{ eq }}</td>
        <td>{{ info.responsible.name }} ({{ info.responsible.email }})</td>
        <td>
          {% if info.status == "done" %}
            ✅ 입력 완료
          {% else %}
            ❌ 미입력
          {% endif %}
        </td>
        <td>
          <a href="{{ url_for('edit_equipment', ship_number=selected_ship, category=cat, eq=eq) }}">Edit</a>
        </td>
      </tr>
      {% endfor %}
    {% endfor %}
  </table>
  {% endif %}
</body>
</html>
